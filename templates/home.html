<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Automation - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f7f9fc;
        }
        .navbar {
            background-color: #1a73e8;
        }
        .navbar-brand, .navbar-brand img {
            height: 40px;
        }
        .card {
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .btn-action {
            margin: 0 2px;
        }
        .status-badge {
            font-size: 0.85rem;
        }
    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center" href="#">
            <img src="data:image/png;base64,{{ base64_logo }}" alt="Logo" class="me-2">
            Automation Dashboard
        </a>
    </div>
</nav>

<div class="container my-5">

    <!-- Candidate Form -->
    <div class="card p-4 mb-5">
        <h4 class="mb-3">Add New Candidate</h4>
        <form method="POST">
            {{ form.hidden_tag() }}
            <div class="row g-3">
                <div class="col-md-4">
                    <div class="form-floating">
                        {{ form.name(class="form-control", placeholder="Name") }}
                        <label>Name</label>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-floating">
                        {{ form.email(class="form-control", placeholder="Email") }}
                        <label>Email</label>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-floating">
                        {{ form.role(class="form-control", placeholder="Role") }}
                        <label>Role</label>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-floating">
                        {{ form.start_date(class="form-control", placeholder="Start Date") }}
                        <label>Start Date</label>
                    </div>
                </div>
            </div>
            <div class="mt-3 text-end">
                <button type="submit" class="btn btn-primary px-4">Add Candidate</button>
            </div>
        </form>
    </div>

    <!-- Candidates Table -->
    <div class="card p-4">
        <h4 class="mb-3">Candidates List</h4>
        <table class="table table-hover align-middle">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Status</th>
                    <th>PDFs</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for candidate in candidates %}
                <tr>
                    <td>{{ candidate.name }}</td>
                    <td>{{ candidate.email }}</td>
                    <td>{{ candidate.role }}</td>
                    <td>
                        {% if candidate.status == "offer_generated" %}
                            <span class="badge bg-success status-badge">Offer Generated</span>
                        {% elif candidate.status == "certificate_generated" %}
                            <span class="badge bg-info status-badge">Certificate Generated</span>
                        {% else %}
                            <span class="badge bg-secondary status-badge">Pending</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if candidate.offer_pdf %}
                            <a href="{{ url_for('download_generated', filename=candidate.offer_pdf) }}" class="btn btn-sm btn-outline-primary btn-action">Offer</a>
                        {% endif %}
                        {% if candidate.certificate_pdf %}
                            <a href="{{ url_for('download_generated', filename=candidate.certificate_pdf) }}" class="btn btn-sm btn-outline-success btn-action">Cert</a>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('generate_offer', candidate_id=candidate.id) }}" class="btn btn-sm btn-primary btn-action">ðŸ“„ Offer</a>
                        <a href="{{ url_for('generate_certificate', candidate_id=candidate.id) }}" class="btn btn-sm btn-success btn-action">ðŸŽ“ Cert</a>
                        <a href="{{ url_for('send_email_route', candidate_id=candidate.id, doc_type='offer') }}" class="btn btn-sm btn-warning btn-action">ðŸ“§ Email Offer</a>
                        <a href="{{ url_for('send_email_route', candidate_id=candidate.id, doc_type='certificate') }}" class="btn btn-sm btn-warning btn-action">ðŸ“§ Email Cert</a>
                        <form action="{{ url_for('delete_candidate', candidate_id=candidate.id) }}" method="POST" style="display:inline;">
                            <button type="submit" class="btn btn-sm btn-danger btn-action" onclick="return confirm('Are you sure?')">ðŸ—‘ Delete</button>
                        </form>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" class="text-center text-muted">No candidates added yet.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</div>

</body>
</html>
